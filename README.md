# Bunyan

A macOS desktop app for managing git repos, worktrees, and Claude Code sessions. Built with Tauri (Rust) and React (TypeScript).

Bunyan owns a dedicated tmux server (`tmux -L bunyan`) and uses it to run Claude Code and shell sessions in the background. iTerm is used as the terminal frontend — Bunyan opens and reuses iTerm windows to attach to tmux sessions as needed.

## Getting Started

### Prerequisites

- **Rust** (stable toolchain) — [rustup.rs](https://rustup.rs)
- **Node.js 22+** — via [mise](https://mise.jdx.dev), nvm, or direct install
- **tmux** — `brew install tmux`
- **iTerm2** — Bunyan uses AppleScript to manage iTerm windows

### Development

```sh
npm install
npx tauri dev
```

This starts the Vite dev server and the Tauri app simultaneously. The Rust backend compiles on first run and hot-reloads on changes. The React frontend has HMR via Vite.

TypeScript bindings (`src/bindings.ts`) are auto-generated by tauri-specta at runtime. If you change Tauri command signatures, the bindings update when the app starts.

### Production Build

```sh
npx tauri build
```

Outputs a `.dmg` and `.app` bundle in `src-tauri/target/release/bundle/`.

## Architecture

```
src/                    React frontend (single-page app)
  App.tsx               Main UI — repos, workspaces, panes, sessions
  bindings.ts           Auto-generated typed Tauri command bindings

src-tauri/src/          Rust backend
  commands/             Tauri command handlers
    repos.rs            CRUD for repositories
    workspaces.rs       Create/archive worktrees
    claude.rs           Session management, pane operations, session history
    settings.rs         Key-value settings
  db/                   SQLite data layer
    schema.rs           Table definitions
    repos.rs            Repo queries
    workspaces.rs       Workspace queries
    settings.rs         Settings queries
  tmux.rs               Tmux server management (tmux -L bunyan)
  terminal.rs           iTerm attachment via AppleScript
  git.rs                Git clone and worktree operations
  models.rs             Shared data types (Repo, Workspace, TmuxPane, etc.)
  error.rs              Error types
  state.rs              App state (DB connection)
```

## Data

- **SQLite DB**: `~/Library/Application Support/com.bunyan.app/bunyan.db`
- **Repos**: cloned to `~/bunyan/repos/<name>/`
- **Worktrees**: created at `~/bunyan/workspaces/<name>/<worktree>/`
- **Session history**: read from `~/.claude/projects/` (Claude Code's own storage)

## Tmux Model

Bunyan runs an isolated tmux server on the `bunyan` socket. The topology:

- **Session** = repository (one per repo)
- **Window** = workspace (one per worktree)
- **Pane** = claude or shell process

Sessions persist across app restarts. Closing iTerm doesn't kill the tmux processes — Claude keeps running in the background. Archiving a workspace kills its tmux window and all panes.

## Key Behaviors

- **Claude button**: attaches to existing Claude pane if one is running, otherwise starts a new one (with `--continue` if a previous session exists)
- **Shell button**: opens a new shell pane in the workspace's tmux window
- **View button**: focuses the iTerm window for a workspace without creating new panes
- **iTerm reuse**: each repo session gets its own iTerm window, reused on subsequent clicks
- **Session history**: reads Claude Code's session files from `~/.claude/projects/`, shows message counts and first prompts
